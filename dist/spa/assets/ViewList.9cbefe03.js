import{Q as le,_ as ae,a as oe}from"./DrawerAppBar.9c80f38c.js";import{j as se,f as te,W as ue,aW as ie,aX as de,S as ne,d as E,r as V,v as M,o as f,ah as $,a as s,Q as h,w as b,aY as N,s as _,aT as A,aU as G,aZ as L,b as d,ax as t,u as i,ag as k,aj as w,al as C,a6 as B,p as j,e as K,ay as P,c as I,a_ as re,h as T,a$ as ce,ak as R,b0 as me}from"./index.5cacb10f.js";import{Q,a as pe,b as ve,c as be}from"./QSpinnerHourglass.3d002817.js";import{Q as O}from"./QForm.da4fc38a.js";import{d as W,c as p,v as U,b as Ve}from"./funcionesValidar.66d5eda5.js";import{_ as z}from"./plugin-vue_export-helper.21dcd24c.js";import"./QChip.70763f59.js";const fe=se("div",{class:"q-space"});var _e=te({name:"QSpace",setup(){return()=>fe}});function F(u){if(u===!1)return 0;if(u===!0||u===void 0)return 1;const c=parseInt(u,10);return isNaN(c)?0:c}var H=ue({name:"close-popup",beforeMount(u,{value:c}){const m={depth:F(c),handler(v){m.depth!==0&&setTimeout(()=>{const r=ie(u);r!==void 0&&de(r,v,m.depth)})},handlerKey(v){ne(v,13)===!0&&m.handler(v)}};u.__qclosepopup=m,u.addEventListener("click",m.handler),u.addEventListener("keyup",m.handlerKey)},updated(u,{value:c,oldValue:m}){c!==m&&(u.__qclosepopup.depth=F(c))},beforeUnmount(u){const c=u.__qclosepopup;u.removeEventListener("click",c.handler),u.removeEventListener("keyup",c.handlerKey),delete u.__qclosepopup}});const X=u=>(j("data-v-9818e11e"),u=u(),K(),u),ye={class:"q-pa-md q-gutter-sm"},ge=X(()=>d("div",{class:"text-h6"},"Editar Usuario",-1)),Ue={class:"row q-col-gutter-md"},we={class:"row q-col-gutter-md"},$e={class:"password-criteria q-pa-sm"},qe=X(()=>d("div",{class:"text-subtitle2 q-mb-sm"},"Criterios de Contrase\xF1a:",-1)),ke={key:0},Ce={class:"row q-col-gutter-md"},xe={key:1},he={class:"row q-col-gutter-md"},De={class:"row justify-end q-gutter-sm q-mt-md"},Se=E({__name:"ModalEditUsersComponent",props:{row:{},type:{}},emits:["userUpdated"],setup(u,{emit:c}){const m=c,v=V([]),r=u,o=V(!1),a=V({...r.row}),x=V(a.value.pass),q=()=>{a.value={...r.row},o.value=!0},D=async()=>{try{const n={id:a.value.id,username:a.value.username,pass:a.value.pass,email:a.value.email,dni:a.value.dni,nombre:a.value.nombre,apellido:a.value.apellido,token:a.value.token,dir:a.value.dir,tel:a.value.tel,usertype:a.value.usertype},l=r.type==="paciente"?{id:a.value.id,contact_emerg:a.value.contact_emerg,especialidad_requerida:a.value.especialidad_requerida,medicamentos:a.value.medicamentos,alergias:a.value.alergias,id_supervisor:a.value.id_supervisor.value}:r.type==="supervisor"?{id:a.value.id,disponibilidad:a.value.disponibilidad,titulacion:a.value.titulacion,salario:a.value.salario}:null;console.log(n),console.log(l),console.log(r.row.id),await _.axiosPut(`https://18.214.47.239/backend/user.php?table=usuario&id=${r.row.id}`,n),await _.axiosPut(`https://18.214.47.239/backend/user.php?table=${r.type}&id=${r.row.id}`,l),P("positive","Usuario actualizado"),m("userUpdated"),o.value=!1}catch(n){console.log(n)}};return M(async()=>{try{const n=await _.axiosGet("https://18.214.47.239/backend/user.php?table=usuario&usertype=supervisor");v.value=n.map(l=>({label:l.nombre+" "+l.apellido,value:l.id}))}catch(n){console.error("Error fetching supervisors:",n)}}),(n,l)=>(f(),$("div",ye,[s(h,{icon:"edit",color:"primary",onClick:q}),s(N,{modelValue:o.value,"onUpdate:modelValue":l[21]||(l[21]=e=>o.value=e),"transition-show":"scale","transition-hide":"scale"},{default:b(()=>[s(A,{style:{"max-width":"600px",width:"100%"}},{default:b(()=>[s(G,null,{default:b(()=>[ge]),_:1}),s(O,{onSubmit:L(D,["prevent"]),class:"q-gutter-md q-pa-md"},{default:b(()=>[d("div",null,[d("div",Ue,[s(t,{modelValue:a.value.id,"onUpdate:modelValue":l[0]||(l[0]=e=>a.value.id=e),label:"ID",disable:"",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{modelValue:a.value.username,"onUpdate:modelValue":l[1]||(l[1]=e=>a.value.username=e),label:"Username",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{modelValue:a.value.email,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.email=e),label:"Email",type:"email",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{modelValue:a.value.dni,"onUpdate:modelValue":l[3]||(l[3]=e=>a.value.dni=e),label:"DNI",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{modelValue:a.value.nombre,"onUpdate:modelValue":l[4]||(l[4]=e=>a.value.nombre=e),label:"Nombre",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{modelValue:a.value.apellido,"onUpdate:modelValue":l[5]||(l[5]=e=>a.value.apellido=e),label:"Apellido",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{modelValue:a.value.token,"onUpdate:modelValue":l[6]||(l[6]=e=>a.value.token=e),label:"Token",filled:"",class:"col-6",disable:""},null,8,["modelValue"]),s(t,{modelValue:a.value.dir,"onUpdate:modelValue":l[7]||(l[7]=e=>a.value.dir=e),label:"Direcci\xF3n",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{modelValue:a.value.tel,"onUpdate:modelValue":l[8]||(l[8]=e=>a.value.tel=e),label:"Tel\xE9fono",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{modelValue:a.value.fecha_creacion,"onUpdate:modelValue":l[9]||(l[9]=e=>a.value.fecha_creacion=e),label:"Fecha de Creaci\xF3n",disable:"",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{modelValue:a.value.usertype,"onUpdate:modelValue":l[10]||(l[10]=e=>a.value.usertype=e),label:"Tipo de Usuario",disable:"",filled:"",class:"col-6"},null,8,["modelValue"])]),d("div",we,[s(t,{type:"password",modelValue:a.value.pass,"onUpdate:modelValue":l[11]||(l[11]=e=>a.value.pass=e),label:"Contrase\xF1a *",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{label:"Confirm Password *",modelValue:x.value,"onUpdate:modelValue":l[12]||(l[12]=e=>x.value=e),disable:!i(W)(a.value.pass),filled:"",class:"col-6",type:"password",rules:[e=>e&&e===a.value.pass||"No coinciden."]},null,8,["modelValue","disable","rules"]),d("div",$e,[qe,d("div",null,[s(k,{name:i(p).length?"check_circle":"cancel",color:i(p).length?"positive":"negative"},null,8,["name","color"]),w("Debe tener una longitud de 9 caracteres")]),d("div",null,[s(k,{name:i(p).capital?"check_circle":"cancel",color:i(p).capital?"positive":"negative"},null,8,["name","color"]),w("Debe contener al menos una mayuscula")]),d("div",null,[s(k,{name:i(p).number?"check_circle":"cancel",color:i(p).number?"positive":"negative"},null,8,["name","color"]),w("Tiene que contener al menos un numero")]),d("div",null,[s(k,{name:i(p).symbol?"check_circle":"cancel",color:i(p).symbol?"positive":"negative"},null,8,["name","color"]),w("Debe contener algun caracter especial: !@.#$%^&*()-_+=")])])])]),r.type==="paciente"?(f(),$("div",ke,[d("div",Ce,[s(t,{modelValue:a.value.contact_emerg,"onUpdate:modelValue":l[13]||(l[13]=e=>a.value.contact_emerg=e),label:"Contacto de Emergencia",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{modelValue:a.value.especialidad_requerida,"onUpdate:modelValue":l[14]||(l[14]=e=>a.value.especialidad_requerida=e),label:"Especialidad Requerida",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{modelValue:a.value.medicamentos,"onUpdate:modelValue":l[15]||(l[15]=e=>a.value.medicamentos=e),label:"Medicamentos",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{modelValue:a.value.alergias,"onUpdate:modelValue":l[16]||(l[16]=e=>a.value.alergias=e),label:"Alergias",filled:"",class:"col-6"},null,8,["modelValue"]),s(Q,{require:"",modelValue:a.value.id_supervisor,"onUpdate:modelValue":l[17]||(l[17]=e=>a.value.id_supervisor=e),options:v.value,label:"Seleccione un supervisor",filled:"",class:"col-6",selected:""},null,8,["modelValue","options"])])])):C("",!0),r.type==="supervisor"?(f(),$("div",xe,[d("div",he,[s(t,{modelValue:a.value.disponibilidad,"onUpdate:modelValue":l[18]||(l[18]=e=>a.value.disponibilidad=e),label:"Disponibilidad",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{modelValue:a.value.titulacion,"onUpdate:modelValue":l[19]||(l[19]=e=>a.value.titulacion=e),label:"Titulacion",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{modelValue:a.value.salario,"onUpdate:modelValue":l[20]||(l[20]=e=>a.value.salario=e),label:"Salario",filled:"",class:"col-6"},null,8,["modelValue"])])])):C("",!0),d("div",De,[s(h,{type:"submit",label:"Guardar",color:"primary"}),B(s(h,{label:"Cerrar",color:"secondary",flat:""},null,512),[[H]])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});var Ee=z(Se,[["__scopeId","data-v-9818e11e"]]);const Y=u=>(j("data-v-61a1c2a0"),u=u(),K(),u),Te={class:"q-pa-md q-gutter-sm"},Qe=Y(()=>d("div",{class:"text-h6"},"A\xF1adir Usuario",-1)),Pe={class:"row q-col-gutter-md"},Ie={class:"row q-col-gutter-md"},Re={class:"password-criteria q-pa-sm"},Fe=Y(()=>d("div",{class:"text-subtitle2 q-mb-sm"},"Criterios de Contrase\xF1a:",-1)),Me={key:0},Ne={class:"row q-col-gutter-md"},Ae={key:1},Ge={class:"row q-col-gutter-md"},Le={class:"row justify-end q-gutter-sm q-mt-md"},Be=E({__name:"ModalCreateUsersComponent",emits:["userUpdated"],setup(u,{emit:c}){const m=c,v=V(""),r=V([]),o=V({username:"",pass:"",mail:"",dni:"",nombre:"",apellido:"",dir:"",tel:"",usertype:"",contact_emerg:"",especialidad_requerida:"",medicamentos:"",alergias:"",id_supervisor:{value:"",label:""},disponibilidad:"",titulacion:"",salario:""}),a=V(!1),x=()=>{a.value=!0},q=async()=>{const n={id:re(),username:o.value.username,pass:o.value.pass,email:o.value.mail,dni:o.value.dni,nombre:o.value.nombre,apellido:o.value.apellido,dir:o.value.dir,tel:o.value.tel,usertype:o.value.usertype},l=o.value.usertype==="paciente"?{id:n.id,contact_emerg:o.value.contact_emerg,especialidad_requerida:o.value.especialidad_requerida,medicamentos:o.value.medicamentos,alergias:o.value.alergias,id_supervisor:o.value.id_supervisor.value}:o.value.usertype==="supervisor"?{id:n.id,disponibilidad:o.value.disponibilidad,titulacion:o.value.titulacion,salario:o.value.salario}:null;console.log(n),console.log(l),await _.axiosPost("https://18.214.47.239/backend/user.php?table=usuario",n),await _.axiosPost(`https://18.214.47.239/backend/user.php?table=${o.value.usertype}`,l),m("userUpdated"),P("positive","Usuario Creado"),D(),a.value=!1},D=()=>{o.value={username:"",pass:"",mail:"",dni:"",nombre:"",apellido:"",dir:"",tel:"",usertype:"",contact_emerg:"",especialidad_requerida:"",medicamentos:"",alergias:"",id_supervisor:{value:"",label:""},disponibilidad:"",titulacion:"",salario:""}};return M(async()=>{try{const n=await _.axiosGet("https://18.214.47.239/backend/user.php?table=usuario&usertype=supervisor");r.value=n.map(l=>({label:l.nombre+" "+l.apellido,value:l.id}))}catch(n){console.error("Error fetching supervisors:",n)}}),(n,l)=>(f(),$("div",Te,[s(h,{icon:"add",color:"primary",onClick:x}),s(N,{modelValue:a.value,"onUpdate:modelValue":l[19]||(l[19]=e=>a.value=e),"transition-show":"scale","transition-hide":"scale"},{default:b(()=>[s(A,{style:{"max-width":"600px",width:"100%"}},{default:b(()=>[s(G,null,{default:b(()=>[Qe]),_:1}),s(O,{onSubmit:L(q,["prevent"]),class:"q-gutter-md q-pa-md"},{default:b(()=>[d("div",null,[d("div",Pe,[s(t,{modelValue:o.value.username,"onUpdate:modelValue":l[0]||(l[0]=e=>o.value.username=e),label:"Username",filled:"",class:"col-6",required:"",rules:[e=>i(U)(e)||"Rellena correctamente"]},null,8,["modelValue","rules"]),s(t,{modelValue:o.value.mail,"onUpdate:modelValue":l[1]||(l[1]=e=>o.value.mail=e),label:"Email",type:"email",filled:"",class:"col-6",required:"",rules:[e=>i(Ve)(e)||"Tiene que ser un correo permitido"]},null,8,["modelValue","rules"]),s(t,{modelValue:o.value.dni,"onUpdate:modelValue":l[2]||(l[2]=e=>o.value.dni=e),label:"DNI",filled:"",class:"col-6",required:""},null,8,["modelValue"]),s(t,{modelValue:o.value.nombre,"onUpdate:modelValue":l[3]||(l[3]=e=>o.value.nombre=e),label:"Nombre",filled:"",class:"col-6",rules:[e=>i(U)(e)||"Rellena correctamente"]},null,8,["modelValue","rules"]),s(t,{modelValue:o.value.apellido,"onUpdate:modelValue":l[4]||(l[4]=e=>o.value.apellido=e),label:"Apellido",filled:"",class:"col-6",rules:[e=>i(U)(e)||"Rellena correctamente"]},null,8,["modelValue","rules"]),s(t,{modelValue:o.value.dir,"onUpdate:modelValue":l[5]||(l[5]=e=>o.value.dir=e),label:"Direcci\xF3n",filled:"",class:"col-6",rules:[e=>i(U)(e)||"Rellena correctamente"]},null,8,["modelValue","rules"]),s(t,{modelValue:o.value.tel,"onUpdate:modelValue":l[6]||(l[6]=e=>o.value.tel=e),label:"Telefono",mask:"###-###-###","unmasked-value":"",filled:"",class:"col-6"},null,8,["modelValue"]),s(Q,{modelValue:o.value.usertype,"onUpdate:modelValue":l[7]||(l[7]=e=>o.value.usertype=e),options:["paciente","supervisor"],label:"Tipo de Usuario",filled:"",class:"col-6"},null,8,["modelValue"])]),d("div",Ie,[s(t,{type:"password",modelValue:o.value.pass,"onUpdate:modelValue":l[8]||(l[8]=e=>o.value.pass=e),label:"Contrase\xF1a *",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{label:"Confirm Password *",modelValue:v.value,"onUpdate:modelValue":l[9]||(l[9]=e=>v.value=e),disable:!i(W)(o.value.pass),filled:"",class:"col-6",type:"password",rules:[e=>e&&e===o.value.pass||"No coinciden."]},null,8,["modelValue","disable","rules"]),d("div",Re,[Fe,d("div",null,[s(k,{name:i(p).length?"check_circle":"cancel",color:i(p).length?"positive":"negative"},null,8,["name","color"]),w("Debe tener una longitud de 9 caracteres")]),d("div",null,[s(k,{name:i(p).capital?"check_circle":"cancel",color:i(p).capital?"positive":"negative"},null,8,["name","color"]),w("Debe contener al menos una mayuscula")]),d("div",null,[s(k,{name:i(p).number?"check_circle":"cancel",color:i(p).number?"positive":"negative"},null,8,["name","color"]),w("Tiene que contener al menos un numero")]),d("div",null,[s(k,{name:i(p).symbol?"check_circle":"cancel",color:i(p).symbol?"positive":"negative"},null,8,["name","color"]),w("Debe contener algun caracter especial: !@.#$%^&*()-_+=")])])])]),o.value.usertype==="paciente"?(f(),$("div",Me,[d("div",Ne,[s(t,{modelValue:o.value.contact_emerg,"onUpdate:modelValue":l[10]||(l[10]=e=>o.value.contact_emerg=e),label:"Contacto de Emergencia",mask:"###-###-###","unmasked-value":"",filled:"",class:"col-6"},null,8,["modelValue"]),s(t,{modelValue:o.value.especialidad_requerida,"onUpdate:modelValue":l[11]||(l[11]=e=>o.value.especialidad_requerida=e),label:"Especialidad Requerida",filled:"",class:"col-6",rules:[e=>i(U)(e)||"Rellena correctamente"]},null,8,["modelValue","rules"]),s(t,{modelValue:o.value.medicamentos,"onUpdate:modelValue":l[12]||(l[12]=e=>o.value.medicamentos=e),label:"Medicamentos",filled:"",class:"col-6",rules:[e=>i(U)(e)||"Rellena correctamente"]},null,8,["modelValue","rules"]),s(t,{modelValue:o.value.alergias,"onUpdate:modelValue":l[13]||(l[13]=e=>o.value.alergias=e),label:"Alergias",filled:"",class:"col-6",rules:[e=>i(U)(e)||"Rellena correctamente"]},null,8,["modelValue","rules"]),s(Q,{modelValue:o.value.id_supervisor,"onUpdate:modelValue":l[14]||(l[14]=e=>o.value.id_supervisor=e),options:r.value,label:"Seleccione un supervisor",filled:"",class:"col-6",selected:""},null,8,["modelValue","options"])])])):C("",!0),o.value.usertype==="supervisor"?(f(),$("div",Ae,[d("div",Ge,[s(t,{modelValue:o.value.disponibilidad,"onUpdate:modelValue":l[15]||(l[15]=e=>o.value.disponibilidad=e),label:"Disponibilidad",filled:"",class:"col-6",rules:[e=>i(U)(e)||"Rellena correctamente"]},null,8,["modelValue","rules"]),s(t,{modelValue:o.value.titulacion,"onUpdate:modelValue":l[16]||(l[16]=e=>o.value.titulacion=e),label:"Titulacion",filled:"",class:"col-6",rules:[e=>i(U)(e)||"Rellena correctamente"]},null,8,["modelValue","rules"]),s(t,{modelValue:o.value.salario,"onUpdate:modelValue":l[17]||(l[17]=e=>o.value.salario=e),label:"Salario",filled:"",class:"col-6",type:"number",suffix:"\u20AC"},null,8,["modelValue"])])])):C("",!0),d("div",Le,[o.value.usertype?(f(),I(h,{key:0,type:"submit",label:"Guardar",color:"primary"})):C("",!0),B(s(h,{label:"Cerrar",color:"secondary",flat:"",onClick:l[18]||(l[18]=e=>D())},null,512),[[H]])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});var je=z(Be,[["__scopeId","data-v-61a1c2a0"]]);const Ke={class:"q-pa-md"},Oe={key:1,class:"spinner-container"},We={key:2},ze=d("h3",null,"Error:",-1),He=E({__name:"TableInfoComponent",props:{table:{}},setup(u){const c=u,m=V(!1),v=V([]),r=V(null),o=V([]),a=T(()=>`https://18.214.47.239/backend/user.php?table=usuario&usertype=${c.table}`),x=T(()=>`https://18.214.47.239/backend/user.php?table=${c.table}`);console.log(a.value),console.log(x.value);const q=async()=>{m.value=!0;try{o.value=[],v.value=[];const y=await _.axiosGetWithTimeout(a.value),n=await _.axiosGetWithTimeout(x.value),l=[...y,...n],e=l.reduce((g,S)=>({...g,...S}),{}),Z=l.reduce((g,S)=>({...g,[S.id]:{...g[S.id]||{},...S}}),{}),J=Object.values(Z),ee=Object.keys(e).map(g=>({name:g,align:"center",label:g.charAt(0).toUpperCase()+g.slice(1),field:g,sortable:!0}));o.value.splice(2,0,...ee),v.value=J,o.value.push({name:"actions",align:"center",label:"Acciones",field:"actions"})}catch(y){r.value="Error al obtener la informaci\xF3n",console.error(y)}finally{m.value=!1}},D=async y=>{try{await _.axiosDelete(`https://18.214.47.239/backend/user.php?table=usuario&id="${y}"`),P("negative","Usuario eliminado"),q()}catch(n){console.log(n)}};return ce(()=>{q()}),(y,n)=>(f(),$("div",Ke,[w(R(i(_))+" ",1),m.value?C("",!0):(f(),I(pe,{key:0,rows:v.value,columns:o.value,"row-key":"id",class:"my-sticky-last-column-table"},{top:b(()=>[s(je,{onUserUpdated:q})]),"body-cell-actions":b(l=>[s(be,{props:l},{default:b(()=>[s(Ee,{row:l.row,type:y.table,onUserUpdated:q},null,8,["row","type"]),s(_e),s(h,{color:"negative",icon:"delete",onClick:e=>D(l.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])),m.value?(f(),$("div",Oe,[s(ve,{size:"50px",color:"primary"})])):C("",!0),r.value?(f(),$("div",We,[ze,d("p",null,R(r.value),1)])):C("",!0)]))}}),ol=E({__name:"ViewList",setup(u){const c=me(),m=T(()=>c.fullPath.split("/")[2]);return(v,r)=>(f(),I(le,{view:"hHh lpR fFf"},{default:b(()=>[s(oe,null,{default:b(()=>[s(ae),s(He,{table:m.value},null,8,["table"])]),_:1})]),_:1}))}});export{ol as default};
